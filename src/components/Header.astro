---
import { Menu, Home, BookOpen, Trophy, User, Wrench, Gift, Map, Calendar, Calculator, ExternalLink, ChevronDown } from 'lucide-astro';
import siteData from '../data/site.json';

const { navigation } = siteData;
const currentPath = Astro.url.pathname;

const iconMap: Record<string, any> = {
  'home': Home,
  'book-open': BookOpen,
  'trophy': Trophy,
  'user': User,
  'wrench': Wrench,
  'gift': Gift,
  'map': Map,
  'calendar': Calendar,
  'calculator': Calculator,
  'external-link': ExternalLink,
};
---

<header class="navbar bg-base-200 sticky top-0 z-50 shadow-lg border-b border-primary/20 min-h-14">
  <div class="container mx-auto px-4 flex items-center justify-between">
    <!-- Logo -->
    <a href="/" class="flex items-center gap-2 text-xl font-bold hover:opacity-80 transition-opacity">
      <img src="/logo.svg" alt="Streetdog BMX" class="h-10 w-auto" />
      <span class="hidden md:inline text-base-content">Streetdog BMX</span>
    </a>
    
    <!-- Desktop Navigation -->
    <nav class="hidden lg:flex items-center gap-1">
      {navigation.map((item) => {
        const Icon = iconMap[item.icon];
        return item.children ? (
          <div class="dropdown dropdown-hover dropdown-bottom">
            <label tabindex="0" class="btn btn-ghost btn-sm gap-1.5">
              {Icon && <Icon class="h-4 w-4" />}
              <span>{item.label}</span>
              <ChevronDown class="h-3 w-3 opacity-60" />
            </label>
            <ul tabindex="0" class="dropdown-content menu bg-base-200 rounded-box w-52 p-2 shadow-xl border border-base-300 mt-1">
              {item.children.map((child) => (
                <li>
                  <a 
                    href={child.href}
                    class={currentPath === child.href ? 'active' : ''}
                  >
                    {child.label}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        ) : (
          <a 
            href={item.href}
            class={`btn btn-ghost btn-sm gap-1.5 ${currentPath === item.href ? 'btn-active bg-primary text-primary-content' : ''}`}
          >
            {Icon && <Icon class="h-4 w-4" />}
            <span>{item.label}</span>
          </a>
        );
      })}
    </nav>
    
    <!-- Mobile Menu Button -->
    <div class="dropdown dropdown-end lg:hidden">
      <label tabindex="0" class="btn btn-ghost btn-circle">
        <Menu class="h-6 w-6" />
      </label>
      <ul tabindex="0" class="dropdown-content menu bg-base-200 rounded-box w-64 p-2 shadow-xl border border-base-300 mt-2 max-h-[70vh] overflow-y-auto">
        {navigation.map((item) => {
          const Icon = iconMap[item.icon];
          return (
            <li>
              {item.children ? (
                <>
                  <span class="menu-title flex items-center gap-2 text-primary">
                    {Icon && <Icon class="h-4 w-4" />}
                    {item.label}
                  </span>
                  <ul>
                    {item.children.map((child) => (
                      <li>
                        <a 
                          href={child.href}
                          class={currentPath === child.href ? 'active' : ''}
                        >
                          {child.label}
                        </a>
                      </li>
                    ))}
                  </ul>
                </>
              ) : (
                <a 
                  href={item.href}
                  class={`flex items-center gap-2 ${currentPath === item.href ? 'active' : ''}`}
                >
                  {Icon && <Icon class="h-4 w-4" />}
                  <span>{item.label}</span>
                </a>
              )}
            </li>
          );
        })}
      </ul>
    </div>
  </div>
</header>

<style>
  .navbar {
    backdrop-filter: blur(10px);
    background-color: rgba(45, 45, 45, 0.95);
  }
  
  /* Active state for menu items */
  .menu .active,
  .btn-active {
    background-color: var(--color-primary) !important;
    color: var(--color-primary-content) !important;
  }
  
  /* Dropdown hover effect */
  .dropdown-hover:hover .dropdown-content {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  .dropdown-content {
    opacity: 0;
    visibility: hidden;
    transform: translateY(-8px);
    transition: all 0.15s ease;
  }
  
  .dropdown:focus-within .dropdown-content {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
</style>
